#!/bin/bash

# set up variables
htmlFD=~/dot/installed/html
markdownF="article.md"
templateF="template.html"
articleF="$(date +"%FT%H%M%z").html"
contentF="content.html"
headlineF="headline.html"
preampleF="preample.html"
postampleF="postample.html"
tempF="_temp.html"

# do the conversion
markdown "$markdownF" > "$contentF"
xmllint --html --xpath "//h1/text()" "$contentF" > "$headlineF"
hxincl -f -x "$templateF" > "$tempF"
hxnormalize -e "$tempF" > "$articleF"

cp "$articleF" $htmlFD
#hxmultitoc -s "$(cat "$preampleF")" -e "$(cat "$postampleF")" "$htmlFD"*.html > "$tempF"
#hxnormalize -e "$tempF" > index.html

# clean up
#rm "$headlineF"
#rm "$contentF"
#rm "$tempF"

# Unused code for reference
# markdown --html4tags article.md | recode utf-8..cp1252 > content.html
# h1=$(hxextract h1 content.html | sed -e 's/<h1>//g' -e 's/<\/h1>//g')
# sed -i 's/"$h1"//g' content.html
# xmllint --html --format $fname
# hxmultitoc > index.html
